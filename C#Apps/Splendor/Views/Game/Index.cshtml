@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model Splendor.Models.IGameBoard
@{
    ViewData["Title"] = "Splendor";


    string purple = "rgb(110, 10, 150)";

    bool IsCurrentPlayer = Model.Players[Model.CurrentPlayer].Id == (int)ViewData["PlayerId"];
}
<body style="margin-bottom: 10rem;">



<!-- Communicating with the server -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript">

    var version = @Model.Version;

    // Pull once after 1 second
    setTimeout(pull, 1000);

    // pulls to the server to see if anything is new
    function pull() {
        $.ajax({
            url: "/Game/State/@ViewData["GameId"]/@ViewData["PlayerId"]",
            type: "GET",
            success: function (response) {

                // if the gameboard's version is different than the current version render the game board and notify!
                if (response.version != version) {
                    renderGameBoard(response);
                }
            },
            error: function () {
                alert("ERROR - Please try again.");
            }
        });

        // Call again every 3 seconds
        setTimeout(pull, 3000);
        return false;
    }

    // when the turn requires further action
    function continueAction(data) {
        alert("CONTINUE ACTION");

        // If the code is 0 then return tokens
        if (data.actionCode == 0) {
            alert("RETURNING TOKENS");
            ReturnTokens();

        // If the code is 1 then get a noble
        } else if (data.actionCode == 1) {
            alert("GETTING NOBLES");
            getNobles(data.nobles);
        }
    }

    // When the end turn button is pressed
    function endTurn() {
        $.ajax({
            url: "/Game/EndTurn/@ViewData["GameId"]/@ViewData["PlayerId"]",
            type: "POST",
            data: JSON.stringify(TakingTokens),
            contentType: "application/json",
            dataType: 'json',
            success: function (data) {
                // If there was an error/if the data is a error object -> alert what the error was
                if (data.hasOwnProperty("errorCode")) {
                    alert("ERROR - " + data.message);
                // If there is a continue action/if the data is a continue action object -> continue action
                } else if (data.hasOwnProperty("actionCode")) {
                    continueAction(data);
                }
                // Else if it was successful
                else {
                   
                    // Render the gameboard
                    renderGameBoard();
                }
            },
            error: function () {
                alert("ERROR - Please try again.")
            }
        });
    }

    // When the player purchases a card
    function purchase(ImageName) {
        $.ajax({
            url: "/Game/Purchase/@ViewData["GameId"]/@ViewData["PlayerId"]",
            type: "POST",
            data: JSON.stringify(ImageName),
            contentType: "application/json",
            dataType: 'json',
            success: function (data) {
                // If the data has an error display that error
                if (data.hasOwnProperty("errorCode")) {
                    alert("ERROR - " + data.message);
                // If the data has a continue action -> continue
                } else if (data.hasOwnProperty("actionCode")) {
                    continueAction(data);
                }
                else {
                    // Render the gameboard
                   renderGameBoard(data);
                }
            },
            error: function () {
                alert("ERROR - Please try again.")
            }
        });
    }

    // When the player reserves a card
    function reserve(ImageName) {
        $.ajax({
            url: "/Game/Reserve/@ViewData["GameId"]/@ViewData["PlayerId"]",
            type: "POST",
            data: JSON.stringify(ImageName),
            contentType: "application/json",
            dataType: 'json',
            success: function (data) {
                // If the data has an error display that error
                if (data.hasOwnProperty("errorCode")) {
                    alert("ERROR - " + data.message);
                // If the data has a continue action -> continue
                } else if (data.hasOwnProperty("actionCode")) {
                    continueAction(data);
                }
                else {
                    // Render the gameboard
                   renderGameBoard(data);
                }
            },
            error: function () {
                alert("ERROR - Please try again.")
            }
        });
    }

    // When the player returns tokens
    function returnTokens() {
        // Set all the return tokens to the inverse of itself
        for (token in ReturningTokens) {
            ReturningTokens[token] *= -1;
        }

        $.ajax({
            url: "/Game/Return/@ViewData["GameId"]/@ViewData["PlayerId"]",
            type: "POST",
            data: JSON.stringify(merge(ReturningTokens, TakingTokens)), // merge the two objects
            contentType: "application/json",
            dataType: 'json',
            success: function (data) {
                // If the data has an error display that error
                if (data.hasOwnProperty("errorCode")) {
                    alert("ERROR - " + data.message);
                // If the data had a continue action -> continue
                } else if (data.hasOwnProperty("actionCode")) {
                    continueAction(data);
                }
                else {
                    //Render the gameboard
                    renderGameBoard();
                }
            },
            error: function () {
                alert("ERROR - Please try again.")
            }
        });
    }

    // When the player gets a noble
    function noble(ImageName) {

        alert(JSON.stringify(ImageName));

        $.ajax({
            url: "/Game/Noble/@ViewData["GameId"]/@ViewData["PlayerId"]",
            type: "POST",
            data: JSON.stringify(ImageName),
            contentType: "application/json",
            dataType: 'json',
            success: function (data) {
                // If the data has an error display that error
                if (data.hasOwnProperty("errorCode")) {
                    alert("ERROR - " + data.message);
                // If the data has a continue action -> continue
                } else if (data.hasOwnProperty("actionCode")) {
                    continueAction(data);
                } else {
                    alert("SUCCESS");
                    // Render the gameboard
                    renderGameBoard(data);
                }
            },
            error: function () {
                alert("ERROR - Please try again.")
            }
        });
    }
    </script>





<!-- Options button -->
    <nav class="navbar">   
        <script>
            
        </script>
        <div class="mx-3 btn" onclick='ToggleScreen("OptionsScreen")' > 
            @for (int j = 0; j < 3; j++)
            {
                <svg width="0.8rem" height="1rem">
                    <circle cx="50%" cy="50%" r="5" fill="gray"/>
                </svg>
            }
            </div>
    </nav>

<section class="container row mx-auto p-2 maxContainer">

    <!-- Player Stats -->
        <section class="col-12 m-0 mt-5 p-2
                        col-lg-6 mt-lg-5 m-lg-0 p-lg-4 mt-xl-0 pt-xl-0">
            @{
                string borderColor = "gray";
                int playerOrdinal = 0;
                int i = playerOrdinal - 1;
                int count = 0;
                string playerCardId = count.ToString() + "-card";
            }

            @for (int j = 0; j < Model.Players.Count; j++)
            {
                @if (Model.Players[j].Id == (int)ViewData["PlayerId"])
                {
                    playerOrdinal = j;
                    i = j - 1;
                    break;
                }
            }
            @while (count < Model.Players.Count)
            {
                playerCardId = count.ToString() + "-card";
                count++;
                i++;

                if (i >= Model.Players.Count)
                {
                    i -= Model.Players.Count;
                }


                if (i == Model.CurrentPlayer)
                {
                    borderColor = @purple;
                }
                else
                {
                    borderColor = "gray";
                }

               

                <section id="@playerCardId" class="container row rounded-3 mt-3 mx-auto pb-1 px-0" style="border: 2px solid @borderColor;">
                    <div class="col-12 container
                                col-md-6
                                col-lg-12
                                playerStatsContainer">
                        <h3 class="row ms-3">@Model.Players[i].Name</h3>
                        <table class="mb-1">
                            <!--Total of Tokens + Cards-->
                                <tr>
                                    <th></th>
                                    @{
                                        Dictionary<Token, string> Colors = new Dictionary<Token, string>() { { Token.Emerald, "green" }, { Token.Sapphire, "blue" }, { Token.Ruby, "red" }, { Token.Diamond, "white" }, { Token.Onyx, "brown" } };
                                    }
                                        @foreach(KeyValuePair<Token, string> kvp in Colors)
                                        {
                                            <th>
                                                <svg class="playerStats">
                                                    <text id='@Model.Players[i].Id-Total:@kvp.Key' x="50%" y="50%" text-anchor="middle" fill=@kvp.Value stroke="black" font-size="2rem" stroke-width="1px" dy=".35em">@(Model.Players[i].Tokens[kvp.Key] + Model.Players[i].CardTokens[kvp.Key])</text>
                                                </svg>
                                            </th>
                                        }

                                        <th>
                                            <svg class="playerStats">
                                                    <text id="@Model.Players[i].Id-Total:Gold" x="50%" y="50%" text-anchor="middle" fill="yellow" stroke="black" font-size="2rem" stroke-width="1px" dy=".35em">@Model.Players[i].Tokens[Token.Gold]</text>
                                            </svg>
                                        </th>
                                </tr>

                            <!--Total Tokens-->
                                <tr>
                                    <td>
                                        <svg class="playerStats">
                                            <text id="@Model.Players[i].Id-TokenTotal" x="50%" y="50%" text-anchor="middle" fill="gray" stroke="black" font-size="2rem" stroke-width="1px" dy=".35em">@Model.Players[i].NumberOfTokens()</text>
                                        </svg>
                                    </td>
                                    @foreach(KeyValuePair<Token, string> kvp in Colors)
                                    {
                                        <td>
                                            <svg class="playerStats">
                                                <circle cx="50%" cy="50%" r="20" fill=@kvp.Value />
                                                <text id="@Model.Players[i].Id-Token:@kvp.Key" x="50%" y="50%" text-anchor="middle" fill="gray" stroke="black" font-size="2rem" stroke-width="1px" dy=".35em">@Model.Players[i].Tokens[kvp.Key]</text>
                                            </svg>
                                        </td>
                                    }

                                    <td>
                                        <svg class="playerStats">
                                            <circle cx="50%" cy="50%" r="20" fill="yellow" />
                                            <text id="@Model.Players[i].Id-Token:Gold" x="50%" y="50%" text-anchor="middle" fill="gray" stroke="black" font-size="2rem" stroke-width="1px" dy=".35em">@Model.Players[i].Tokens[Token.Gold]</text>
                                        </svg>
                                    </td>
                                </tr>

                            <!--Total Cards and Prestige Points-->
                                <tr>
                                    <td>
                                        <svg class="playerStats">
                                            <text id="@Model.Players[i].Id-PrestigePoints" x="50%" y="50%" text-anchor="middle" fill="gray" stroke="black" font-size="2rem" stroke-width="1px" dy=".35em">@Model.Players[i].PrestigePoints</text>
                                        </svg>
                                    </td>
                                    @foreach(KeyValuePair<Token, string> kvp in Colors)
                                    {
                                        <td>
                                            <svg class="playerStats">
                                                <rect x="10%" rx="10" ry="10" width="2.4rem" height="3rem" fill=@kvp.Value />
                                                <text id="@Model.Players[i].Id-Card:@kvp.Key" x="50%" y="50%" text-anchor="middle" fill="gray" stroke="black" font-size="2rem" stroke-width="1px" dy=".35em">@Model.Players[i].CardTokens[kvp.Key]</text>
                                            </svg>
                                        </td>
                                    }
                                </tr>
                        </table>
                    </div>

                    <!-- Resereved Cards -->
                        <div id="ReservedCards" class="col-12 container position-relative
                                    col-md-6 ps-md-5 pe-md-0
                                    col-lg-12 p-lg-0
                                    playerStatsContainer">
                            <div class="row m-0" style="position: relative; top: 50%; transform: translateY(-50%);">
                                @if (Model.Players[i].ReservedCards.Count > 0)
                                {
                                    string BorderColor_r = "gray";
                                    string Opacity_r = "80%";
                                    bool Purchaseable_r = false;
                                    foreach (ICard card in Model.Players[i].ReservedCards)
                                    {
                                        if(playerOrdinal == i && Model.Players[playerOrdinal].CanPurchaseCard(card))
                                        {
                                            BorderColor_r = "green";
                                            Opacity_r = "100%";
                                            Purchaseable_r = true;

                                        }
                                        else
                                        {
                                            BorderColor_r = "gray";
                                            Opacity_r = "80%";
                                            Purchaseable_r = false;

                                        }
                                        <div class="col-4
                                                    col-sm-3
                                                    col-md-4
                                                    ">
                                            <img id="@Model.Players[i].Id-Reserved:@card.ImageName" class="col-12 p-0 card cursorHover" style="border-color: @BorderColor_r; opacity: @Opacity_r;" maxwidth="33%" src="/Images/@card.ImageName" alt=@card.ImageName onclick='ReserveCardScreen("@card.ImageName", @Purchaseable_r)'/>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                </section>
            }
        </section> 

    <!-- Shop -->
        <section id="Shop" class="col-12 m-0 p-2
                        col-lg-6"> 

            <!-- Tokens -->
                <section class="container mx-auto p-0 mb-5" width="100%">
                        <table class="mx-auto" width="100%">
                            <tr>
                                <td id="EmeraldTakingToken"  class="takingToken" onclick="TokenClick('TakingEmerald')"  ><img class="p-0" style="width: 100%" src="/Images/Emerald.png"  alt="EmeraldToken"  /><h1 id="EmeraldTakingTokenValue">0</h1></td>
                                <td id="SapphireTakingToken" class="takingToken" onclick="TokenClick('TakingSapphire')" ><img class="p-0" style="width: 100%" src="/Images/Sapphire.png" alt="SapphireToken" /><h1 id="SapphireTakingTokenValue">0</h1></td>
                                <td id="RubyTakingToken"     class="takingToken" onclick="TokenClick('TakingRuby')"     ><img class="p-0" style="width: 100%" src="/Images/Ruby.png"     alt="RubyToken"     /><h1 id="RubyTakingTokenValue">0</h1></td>
                                <td id="DiamondTakingToken"  class="takingToken" onclick="TokenClick('TakingDiamond')"  ><img class="p-0" style="width: 100%" src="/Images/Diamond.png"  alt="DiamondToken"  /><h1 id="DiamondTakingTokenValue">0</h1></td>
                                <td id="OnyxTakingToken"     class="takingToken" onclick="TokenClick('TakingOnyx')"     ><img class="p-0" style="width: 100%" src="/Images/Onyx.png"     alt="OnyxToken"     /><h1 id="OnyxTakingTokenValue">0</h1></td>
                            </tr>
                            <tr>
                                <td class="token cursorHover" onclick="TokenClick('Emerald')"  ><img class="p-0" style="width: 100%" src="/Images/Emerald.png"  alt="EmeraldToken"  /><h1 id="EmeraldTokenValue" >@Model.TokenStacks[Token.Emerald]</h1></td>
                                <td class="token cursorHover" onclick="TokenClick('Sapphire')" ><img class="p-0" style="width: 100%" src="/Images/Sapphire.png" alt="SapphireToken" /><h1 id="SapphireTokenValue">@Model.TokenStacks[Token.Sapphire]</h1></td>
                                <td class="token cursorHover" onclick="TokenClick('Ruby')"     ><img class="p-0" style="width: 100%" src="/Images/Ruby.png"     alt="RubyToken"     /><h1 id="RubyTokenValue"    >@Model.TokenStacks[Token.Ruby]</h1></td>
                                <td class="token cursorHover" onclick="TokenClick('Diamond')"  ><img class="p-0" style="width: 100%" src="/Images/Diamond.png"  alt="DiamondToken"  /><h1 id="DiamondTokenValue" >@Model.TokenStacks[Token.Diamond]</h1></td>
                                <td class="token cursorHover" onclick="TokenClick('Onyx')"     ><img class="p-0" style="width: 100%" src="/Images/Onyx.png"     alt="OnyxToken"     /><h1 id="OnyxTokenValue"    >@Model.TokenStacks[Token.Onyx]</h1></td>
                                <td class="token cursorHover" onclick="TokenClick('Gold')"     ><img class="p-0" style="width: 100%" src="/Images/Gold.png"     alt="GoldToken"     /><h1 id="GoldTokenValue"    >@Model.TokenStacks[Token.Gold]</h1></td>

                            </tr>
                        </table>
                </section>

            <!-- Cards and Nobles -->
                <section class="container mx-auto p-1 border-purple rounded-3 border-5">

                        <table class="mx-auto">
                            <tr>
                                @foreach (INoble noble in Model.Nobles)
                                {
                                    <td><img id="@noble.ImageName" class="card cursorHover" style="width: 100%; opacity: 80%; max-width: 8rem;" src="/Images/@noble.ImageName" alt="@noble" onclick='NobleScreen("@noble.ImageName")' /></td>
                                }
                            </tr>
                        </table>

                        <table class="mx-auto">
                            <tr>
                                @{
                                    string BorderColor = "gray";
                                    string Opacity = "80%";
                                    bool Purchaseable = false;
                                }
                                @foreach (ICard card in Model.Level3Cards)
                                {
                                    if(Model.Players[playerOrdinal].CanPurchaseCard(card))
                                    {
                                        BorderColor = "green";
                                        Opacity = "100%";
                                        Purchaseable = true;

                                    }
                                    else
                                    {
                                        BorderColor = "gray";
                                        Opacity = "80%";
                                        Purchaseable = false;

                                    }

                                    <td><img id="@card.ImageName" class="card cursorHover" style="width: 100%; border-color: @BorderColor; opacity: @Opacity;" src="/Images/@card.ImageName" alt="@card.ImageName" onclick='CardScreen("@card.ImageName", @Purchaseable)' /></td>
                            
                                }
                             </tr>
                             <tr>
                                @foreach (ICard card in Model.Level2Cards)
                                {
                                    if(Model.Players[playerOrdinal].CanPurchaseCard(card))
                                    {
                                        BorderColor = "green";
                                        Opacity = "100%";
                                        Purchaseable = true;

                                    }
                                    else
                                    {
                                        BorderColor = "gray";
                                        Opacity = "80%";
                                        Purchaseable = false;

                                    }

                                    <td><img id="@card.ImageName" class="card cursorHover" style="width: 100%; border-color: @BorderColor; opacity: @Opacity;" src="/Images/@card.ImageName" alt="@card.ImageName" onclick='CardScreen("@card.ImageName", @Purchaseable)' /></td>
                            
                                }
                             </tr>
                             <tr>
                                @foreach (ICard card in Model.Level1Cards)
                                {
                                    if(Model.Players[playerOrdinal].CanPurchaseCard(card))
                                    {
                                        BorderColor = "green";
                                        Opacity = "100%";
                                        Purchaseable = true;

                                    }
                                    else
                                    {
                                        BorderColor = "gray";
                                        Opacity = "80%";
                                        Purchaseable = false;

                                    }
                                    <td><img id="@card.ImageName" class="card cursorHover"  style="width: 100%; border-color: @BorderColor; opacity: @Opacity;" src="/Images/@card.ImageName" alt="@card.ImageName" onclick='CardScreen("@card.ImageName", @Purchaseable)' /></td>
                            
                                }
                             </tr>
                        </table>
                </section>

        </section>

</section>



@if (IsCurrentPlayer)
{
    <button id="endTurnButton" class="btn-darkPurple btn px-5 fs-3" onclick="endTurn();">End Turn</button>
}

<!--Notify Alert-->
    <section class="notify" id="Notify"></section>
     <style>
         .notify {  
              position: fixed;
              top:0px;
              width:100%;
              height: 0;  
              color:white;  
              text-align:center;
              background:rgba(0,0,0,.6);
              overflow:hidden;
              box-sizing:border-box;
              transition:height .2s;
            }
     </style>
     <script>
        window.onload = function () {
            //document.getElementById("Notify").style.height = "5rem";
        }
    </script>

<!-- Options Screen -->

    <section id="OptionsScreen" class="OverlayScreen" style="display: none">
        <div class="mx-auto pt-4 pt-lg-2" style="width: 100%">
            <h1 id="OptionsHeader" class="mt-3 px-auto text-light display-1 text-center mt-xl-1" style="width: 100%">Options</h1>
        </div>
        <div style="margin-top: 23rem; width: 20rem;" class="mt-xl-10 mx-auto text-center">

            <div class="mx-auto purple">
                <button class="mx-auto btn btn-outline-purple btn-lg" style="border: 2px solid var(--purple); width: 100%;" onclick='ToggleScreen("OptionsScreen")'>Resume</button> 
            </div>
            <div class="mx-auto my-3">
                <button class="mx-auto btn btn-outline-darkPurple btn-lg" style="width: 100%;" onclick='ToggleScreen("OptionsScreen")'>Game Log</button> 
            </div>
            <div class="mx-auto my-3">
                <a class="mx-auto btn btn-outline-success btn-lg"  style="width: 100%;" href="https://cdn.1j1ju.com/medias/7f/91/ba-splendor-rulebook.pdf" target="_blank" rel="noopener noreferrer" >Rules</a> 
            </div>
            <div class="mx-auto my-3">
                <button class="mx-auto btn btn-outline-danger btn-lg" style="width: 100%;" onclick='ToggleScreen("OptionsScreen")'>Exit Game</button> 
            </div>
        </div>
    </section>

<!-- Card Screen -->
    <section id="CardScreen" class="OverlayScreen" style="display: none">
    </section>
    <script>
        var True = true, False = false;
        function CardScreen(ImageName, purchaseable=false) {

            let backButton = `<div class="col p-0 pe-3">
                                <div class="purple p-0 mx-auto" style="width: 100%;">
                                    <button class="mx-auto btn btn-outline-light btn-lg" style="width: 100%;" onclick='ToggleScreen("CardScreen")'>Back</button>
                                </div>
                            </div>`;


            let reserveButton = getReserveButton(@IsCurrentPlayer, @(Model.Players[playerOrdinal].ReservedCards.Count < 3), ImageName);
            let selectPurchaseButton = getSelectPurchaseButton(@IsCurrentPlayer, purchaseable, @(Model.Players[playerOrdinal].Tokens[Token.Gold] > 0), ImageName);
            let purchaseButton =             getPurchaseButton(@IsCurrentPlayer, purchaseable, @(Model.Players[playerOrdinal].Tokens[Token.Gold] > 0), ImageName);

            let innerHtml = `
                <img class="mx-auto card mt-6
                            mt-md-7"
                            mt-lg-5" src="/Images/` + ImageName + `" width="auto" style="max-height: 50%"/>
                <div class="container mt-5 mx-auto" style="width: 90%; max-width: 40rem; ">
                    <div class="row">` +
                        backButton +
                        reserveButton +
                    `</div>
                    <div class="row mt-3"> ` +
                        selectPurchaseButton +
                        purchaseButton + `
                    </div>
                <div>`;
                
                    
                    
             
                    
            

            let CardScreen = document.getElementById("CardScreen")

            CardScreen.innerHTML = innerHtml;
            ToggleScreen("CardScreen");
        }
    </script>

<!-- Noble Screen -->
    <section id="NobleScreen" class="OverlayScreen" style="display: none">
    </section>
    <script>
        function NobleScreen(ImageName) {
            let innerHtml = `
                <img class="mx-auto card mt-8
                            mt-md-7"
                            mt-lg-5" src="/Images/` + ImageName + `" width="auto" style="max-width: 75%; max-height: 50%"/>
                <div class="container row mt-5 mx-auto
                            pl-md-6
                            pl-lg-8
                            pl-xl-10" style="width: 100%">
                    <button class="btn btn-outline-light btn-lg" style="width: 10rem;" onclick='ToggleScreen("NobleScreen")'>Back</button>
                </div>
            `;

            let NobleScreen = document.getElementById("NobleScreen")

            NobleScreen.innerHTML = innerHtml;
            ToggleScreen("NobleScreen");
        }
    </script>

<!-- Return Token Screen -->
    <section id="ReturnTokenScreen" class="OverlayScreen" style="display: none">
        <table>
            <tr>
                <td id="EmeraldReturningToken"  class="takingToken" onclick="ReturnTokenClick('ReturningEmerald')"  ><img class="p-0" style="width: 100%" src="/Images/Emerald.png"  alt="EmeraldToken"  /><h1 id="EmeraldReturningTokenValue">0</h1></td>
                <td id="SapphireReturningToken" class="takingToken" onclick="ReturnTokenClick('ReturningSapphire')" ><img class="p-0" style="width: 100%" src="/Images/Sapphire.png" alt="SapphireToken" /><h1 id="SapphireReturningTokenValue">0</h1></td>
                <td id="RubyReturningToken"     class="takingToken" onclick="ReturnTokenClick('ReturningRuby')"     ><img class="p-0" style="width: 100%" src="/Images/Ruby.png"     alt="RubyToken"     /><h1 id="RubyReturningTokenValue">0</h1></td>
                <td id="DiamondReturningToken"  class="takingToken" onclick="ReturnTokenClick('ReturningDiamond')"  ><img class="p-0" style="width: 100%" src="/Images/Diamond.png"  alt="DiamondToken"  /><h1 id="DiamondReturningTokenValue">0</h1></td>
                <td id="OnyxReturningToken"     class="takingToken" onclick="ReturnTokenClick('ReturningOnyx')"     ><img class="p-0" style="width: 100%" src="/Images/Onyx.png"     alt="OnyxToken"     /><h1 id="OnyxReturningTokenValue">0</h1></td>
                <td id="GoldReturningToken"     class="takingToken" onclick="ReturnTokenClick('ReturningGold')"     ><img class="p-0" style="width: 100%" src="/Images/Gold.png"     alt="GoldToken"     /><h1 id="GoldReturningTokenValue">0</h1></td>
            </tr>
            <tr>
                <td class="token cursorHover" onclick="ReturnTokenClick('Emerald')"  ><img class="p-0" style="width: 100%" src="/Images/Emerald.png"  alt="EmeraldToken"  /><h1 id="PlayerEmeraldTokenValue" >@Model.Players[Model.CurrentPlayer].Tokens[Token.Emerald] </h1></td>
                <td class="token cursorHover" onclick="ReturnTokenClick('Sapphire')" ><img class="p-0" style="width: 100%" src="/Images/Sapphire.png" alt="SapphireToken" /><h1 id="PlayerSapphireTokenValue">@Model.Players[Model.CurrentPlayer].Tokens[Token.Sapphire]</h1></td>
                <td class="token cursorHover" onclick="ReturnTokenClick('Ruby')"     ><img class="p-0" style="width: 100%" src="/Images/Ruby.png"     alt="RubyToken"     /><h1 id="PlayerRubyTokenValue"    >@Model.Players[Model.CurrentPlayer].Tokens[Token.Ruby]    </h1></td>
                <td class="token cursorHover" onclick="ReturnTokenClick('Diamond')"  ><img class="p-0" style="width: 100%" src="/Images/Diamond.png"  alt="DiamondToken"  /><h1 id="PlayerDiamondTokenValue" >@Model.Players[Model.CurrentPlayer].Tokens[Token.Diamond] </h1></td>
                <td class="token cursorHover" onclick="ReturnTokenClick('Onyx')"     ><img class="p-0" style="width: 100%" src="/Images/Onyx.png"     alt="OnyxToken"     /><h1 id="PlayerOnyxTokenValue"    >@Model.Players[Model.CurrentPlayer].Tokens[Token.Onyx]    </h1></td>
                <td class="token cursorHover" onclick="ReturnTokenClick('Gold')"     ><img class="p-0" style="width: 100%" src="/Images/Gold.png"     alt="GoldToken"     /><h1 id="PlayerGoldTokenValue"    >@Model.Players[Model.CurrentPlayer].Tokens[Token.Gold]    </h1></td>
            </tr>
        </table>
    </section>
    <script>
        
        function ReturnTokens() {
            let innerHtml = `
                <h1 class="mt-6 display-3 display-sm-1 text-center
                            mt-lg-4
                            mt-xl-5">You have over 10 tokens</h1>
                <h1 class="text-center">You must return ` + (@(Model.Players[Model.CurrentPlayer].NumberOfTokens()) + CountTokens(TakingTokens) - 10) + ` </h1>
                <table class="mx-auto mt-10 mt-sm-6 mt-lg-6" style="max-width: 50rem;">
                    <tr>
                        <td id="EmeraldReturningToken"  class="takingToken" onclick="ReturnTokenClick('ReturningEmerald')"  ><img class="p-0" style="width: 100%" src="/Images/Emerald.png"  alt="EmeraldToken"  /><h1 id="EmeraldReturningTokenValue">0</h1></td>
                        <td id="SapphireReturningToken" class="takingToken" onclick="ReturnTokenClick('ReturningSapphire')" ><img class="p-0" style="width: 100%" src="/Images/Sapphire.png" alt="SapphireToken" /><h1 id="SapphireReturningTokenValue">0</h1></td>
                        <td id="RubyReturningToken"     class="takingToken" onclick="ReturnTokenClick('ReturningRuby')"     ><img class="p-0" style="width: 100%" src="/Images/Ruby.png"     alt="RubyToken"     /><h1 id="RubyReturningTokenValue">0</h1></td>
                        <td id="DiamondReturningToken"  class="takingToken" onclick="ReturnTokenClick('ReturningDiamond')"  ><img class="p-0" style="width: 100%" src="/Images/Diamond.png"  alt="DiamondToken"  /><h1 id="DiamondReturningTokenValue">0</h1></td>
                        <td id="OnyxReturningToken"     class="takingToken" onclick="ReturnTokenClick('ReturningOnyx')"     ><img class="p-0" style="width: 100%" src="/Images/Onyx.png"     alt="OnyxToken"     /><h1 id="OnyxReturningTokenValue">0</h1></td>
                        <td id="GoldReturningToken"     class="takingToken" onclick="ReturnTokenClick('ReturningGold')"     ><img class="p-0" style="width: 100%" src="/Images/Gold.png"     alt="GoldToken"     /><h1 id="GoldReturningTokenValue">0</h1></td>
                    </tr>
                    <tr>
                        <td class="token cursorHover" onclick="ReturnTokenClick('Emerald')"  ><img class="p-0" style="width: 100%" src="/Images/Emerald.png"  alt="EmeraldToken"  /><h1 id="PlayerEmeraldTokenValue" >@Model.Players[Model.CurrentPlayer].Tokens[Token.Emerald] </h1></td>
                        <td class="token cursorHover" onclick="ReturnTokenClick('Sapphire')" ><img class="p-0" style="width: 100%" src="/Images/Sapphire.png" alt="SapphireToken" /><h1 id="PlayerSapphireTokenValue">@Model.Players[Model.CurrentPlayer].Tokens[Token.Sapphire]</h1></td>
                        <td class="token cursorHover" onclick="ReturnTokenClick('Ruby')"     ><img class="p-0" style="width: 100%" src="/Images/Ruby.png"     alt="RubyToken"     /><h1 id="PlayerRubyTokenValue"    >@Model.Players[Model.CurrentPlayer].Tokens[Token.Ruby]    </h1></td>
                        <td class="token cursorHover" onclick="ReturnTokenClick('Diamond')"  ><img class="p-0" style="width: 100%" src="/Images/Diamond.png"  alt="DiamondToken"  /><h1 id="PlayerDiamondTokenValue" >@Model.Players[Model.CurrentPlayer].Tokens[Token.Diamond] </h1></td>
                        <td class="token cursorHover" onclick="ReturnTokenClick('Onyx')"     ><img class="p-0" style="width: 100%" src="/Images/Onyx.png"     alt="OnyxToken"     /><h1 id="PlayerOnyxTokenValue"    >@Model.Players[Model.CurrentPlayer].Tokens[Token.Onyx]    </h1></td>
                        <td class="token cursorHover" onclick="ReturnTokenClick('Gold')"     ><img class="p-0" style="width: 100%" src="/Images/Gold.png"     alt="GoldToken"     /><h1 id="PlayerGoldTokenValue"    >@Model.Players[Model.CurrentPlayer].Tokens[Token.Gold]    </h1></td>
                    </tr>
                </table>


                <div class="container row mt-5 mx-auto p-0" style="width: 100%; max-width: 50rem;">
                    <button class="btn btn-outline-darkPurple btn-lg col mx-3" style="width: 10rem;" onclick='ToggleScreen("ReturnTokenScreen")'>View Shop</button>
                    <button id="ReturnButton" disabled class="btn btn-purple btn-lg col mx-3" style="width: 10rem;" onclick='returnTokens()'>Return</button>
                </div>
            `;

            let ReturnTokenScreen = document.getElementById("ReturnTokenScreen")

            ReturnTokenScreen.innerHTML = innerHtml;
            ToggleScreen("ReturnTokenScreen");
        }
        
    </script>

<!-- Get Noble Screen -->
    <script>
        function getNobles(nobles) {
            alert(JSON.stringify(nobles));

            if (nobles.length > 1) {
                alert("GETTING MORE THAN 1 NOBLE IS NOT IMPLEMMENTED");
            } else {
                alert(nobles[0].imageName);
                noble(nobles[0].imageName);
            }

        }
    </script>

<!-- Reserve Card Screen-->
    <section id="CardScreen" class="OverlayScreen" style="display: none">
    </section>
    <script>
        var True = true, False = false;
        function ReserveCardScreen(ImageName, purchaseable=false) {
            let backButton = `<div class="col p-0 `
            if (purchaseable && @(Model.Players[playerOrdinal].Tokens[Token.Gold] > 0) && @IsCurrentPlayer) {
                backButton += "pe-3";
            }
            
            backButton +=                             `">
                                <div class="purple p-0 mx-auto" style="width: 100%;">
                                    <button class="mx-auto btn btn-outline-light btn-lg" style="width: 100%;" onclick='ToggleScreen("CardScreen")'>Back</button>
                                </div>
                            </div>`;


            let selectPurchaseButton = getSelectPurchaseReserveButton(@IsCurrentPlayer, purchaseable, @(Model.Players[playerOrdinal].Tokens[Token.Gold] > 0), ImageName);
            let purchaseButton =             getPurchaseReserveButton(@IsCurrentPlayer, purchaseable, @(Model.Players[playerOrdinal].Tokens[Token.Gold] > 0), ImageName);

            let innerHtml = `
                <img class="mx-auto card mt-6
                            mt-md-7"
                            mt-lg-5" src="/Images/` + ImageName + `" width="auto" style="max-height: 50%"/>
                <div class="container mt-5 mx-auto" style="width: 90%; max-width: 40rem; ">
                    <div class="row">` +
                        backButton +
                        selectPurchaseButton +
                    `</div>
                    <div class="row mt-3"> ` +
                        purchaseButton + `
                    </div>
                <div>`;
                
                    
                    
             
                    
            

            let CardScreen = document.getElementById("CardScreen")

            CardScreen.innerHTML = innerHtml;

            ToggleScreen("CardScreen");
        }
    </script>
</body>